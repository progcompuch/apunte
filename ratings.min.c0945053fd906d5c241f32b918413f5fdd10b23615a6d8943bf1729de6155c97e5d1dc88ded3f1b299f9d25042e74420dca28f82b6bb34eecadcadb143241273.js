document.addEventListener("DOMContentLoaded",function(){const t=document.getElementById("university-filter"),i=document.getElementById("toggle-icpc"),n=document.getElementById("filter-femeligible"),s=document.getElementById("filter-icpc");function e(){let e=[],o=t.querySelectorAll("input[type='checkbox']:checked");o.forEach(t=>{e.push(t.value.toLowerCase())});let i=s.checked,a=n.checked,r=document.querySelectorAll("table tbody tr");r.forEach(t=>{let n=t.getAttribute("data-university")?.toLowerCase(),s=t.classList.contains("icpc-eligible"),o=t.classList.contains("fem-eligible"),r=e.includes(n),c=!i||s,l=!a||o;t.style.display=r&&c&&l?"table-row":"none"})}t.addEventListener("change",e),s.addEventListener("change",e),n.addEventListener("change",e);async function o(){try{const n=await fetch("http://137.184.14.244:5000/api/userRatings");if(!n.ok)throw new Error("Failed to fetch user ratings");const t=(await n.json()).result;if(!t||t.length===0){console.warn("No user ratings found! Check your API response.");return}updateTables(t),e()}catch(e){console.error("Error fetching ratings:",e)}}o()});function updateTables(e){clearTable("codeforces-tbody"),clearTable("atcoder-tbody"),clearTable("leetcode-tbody");const t={"codeforces-tbody":[],"atcoder-tbody":[],"leetcode-tbody":[]};e.forEach(e=>{e.active&&(t["codeforces-tbody"].push(createTableRow(e.nickname,e.codeforcesRating,"codeforces",e.organization,e.femeligible,e.icpc)),t["atcoder-tbody"].push(createTableRow(e.nickname,e.atcoderRating,"atcoder",e.organization,e.femeligible,e.icpc)),t["leetcode-tbody"].push(createTableRow(e.nickname,e.leetcodeRating,"leetcode",e.organization,e.femeligible,e.icpc)))}),Object.keys(t).forEach(e=>{sortAndRenderTable(e,t[e])})}function createTableRow(e,t,n,s,o,i){const a=document.createElement("tr");return a.setAttribute("data-university",s.toLowerCase()),i&&a.classList.add("icpc-eligible"),o&&a.classList.add("fem-eligible"),a.innerHTML=`
        <td><span class="${getRatingClass(n,t)}">${e}</span></td>
        <td><img src="/images/universities/${s}.png" class="university-logo"></td>
        <td><span class="${getRatingClass(n,t)}">${t}</span></td>
    `,{nickname:e,rating:t,row:a}}function clearTable(e){const t=document.getElementById(e);if(!t){console.warn(`Table ID '${e}' not found!`);return}for(;t.children.length>1;)t.removeChild(t.lastChild)}function sortAndRenderTable(e,t){const n=document.getElementById(e);if(!n){console.warn(`Table '${e}' not found!`);return}t.sort((e,t)=>t.rating-e.rating),t.forEach(e=>{e.row&&n.appendChild(e.row)})}function getRatingClass(e,t){return e==="codeforces"?getCodeforcesRatingClass(t):e==="atcoder"?getAtcoderRatingClass(t):e==="leetcode"?getLeetcodeRatingClass(t):""}function getCodeforcesRatingClass(e){return e<800?"rating-black":e<1200?"rating-gray":e<1400?"rating-green":e<1600?"rating-cyan":e<1900?"rating-blue":e<2100?"rating-purple":e<2400?"rating-orange":"rating-red"}function getAtcoderRatingClass(e){return e<200?"rating-black":e<400?"rating-gray":e<900?"rating-green":e<1400?"rating-cyan":e<1700?"rating-blue":e<2e3?"rating-purple":e<2400?"rating-orange":"rating-red"}function getLeetcodeRatingClass(e){return e<200?"rating-black":e<1400?"rating-gray":e<1600?"rating-green":e<1900?"rating-cyan":e<2100?"rating-blue":e<2400?"rating-purple":e<2900?"rating-orange":"rating-red"}