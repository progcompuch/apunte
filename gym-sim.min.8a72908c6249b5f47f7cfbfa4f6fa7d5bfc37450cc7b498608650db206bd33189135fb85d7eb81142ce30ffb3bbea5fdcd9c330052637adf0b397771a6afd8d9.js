const path=window.location.pathname;function applyDurationFilter(){const e=parseFloat(document.getElementById("filter-duration-min").value)||0,t=parseFloat(document.getElementById("filter-duration-max").value)||1/0,n=document.querySelectorAll("#codeforces-gyms-sim-tbody tr");n.forEach(n=>{const s=n.querySelector("td:last-child");if(!s)return;const o=s.textContent.match(/([\d.]+)/),i=o?parseFloat(o[1]):0;n.style.display=i>=e&&i<=t?"":"none"})}function sortByPdaDescending(){const e=document.getElementById("codeforces-gyms-sim-tbody"),t=Array.from(e.querySelectorAll("tr"));t.sort((e,t)=>{const n=parseInt(e.children[2].textContent.trim())||0,s=parseInt(t.children[2].textContent.trim())||0;return s-n}),t.forEach(t=>e.appendChild(t)),applyDurationFilter()}function sortByChileanDescending(){const e=document.getElementById("codeforces-gyms-sim-tbody"),t=Array.from(e.querySelectorAll("tr"));t.sort((e,t)=>{const n=parseInt(e.children[3].textContent.trim())||0,s=parseInt(t.children[3].textContent.trim())||0;return s-n}),t.forEach(t=>e.appendChild(t)),applyDurationFilter()}async function populateGymsTable(){try{const e=await fetch("https://joliva.cl/api/gymsToSim");if(!e.ok)throw new Error("Failed to fetch gym contests");const t=(await e.json()).result,n=document.getElementById("codeforces-gyms-sim-tbody");t.forEach(e=>{const t=document.createElement("tr"),r=e.stars??0,c="â˜…".repeat(r),i=e=>e===0?"ğŸ¥‡":e===1?"ğŸ¥ˆ":e===2?"ğŸ¥‰":`ğŸµï¸ #${e+1}`,a=e=>e<800?"rating-black":e<1200?"rating-gray":e<1400?"rating-green":e<1600?"rating-cyan":e<1900?"rating-blue":e<2100?"rating-purple":e<2400?"rating-orange":"rating-red",l=(e,t)=>{const s=`ğŸŒ`,o=`<img src="/images/chile-flag-xs.png" alt="ğŸ‡¨ğŸ‡±" style="width: 16px; vertical-align: middle; margin-right: 4px;">`,n=e.map(e=>e.handle).sort();for(const s of t){const e=s.teamMembers.map(e=>e.handle).sort();if(n.length===e.length&&n.every((t,n)=>t===e[n]))return o}return s};let s="";const u=`ğŸŒ`,d=`<img src="/images/chile-flag-xs.png" alt="ğŸ‡¨ğŸ‡±" style="width: 16px; vertical-align: middle; margin-right: 4px;">`;e.chileanTeams&&e.chileanTeams.length>0&&(s=e.chileanTeams.map((e,t)=>{const n=i(t),s=e.teamMembers.map(e=>{const t=a(e.rating??0);return`<span class="${t}">${e.handle}</span>`}).join(", ");return`
                        <div>
                            ${n} (${e.teamRank}) â€“ <strong>${e.teamName}</strong><br>
                            ${d} ${s}<br>
                            âœ… ${e.teamSolves}
                        </div>`}).join("<hr>"));let o="";if(e.pdaTeams&&e.pdaTeams.length>0&&(o=e.pdaTeams.map((t,n)=>{const s=i(n),o=l(t.teamMembers,e.chileanTeams),r=t.teamMembers.map(e=>{const t=a(e.rating??0);return`<span class="${t}">${e.handle}</span>`}).join(", ");return`
                        <div>
                            ${s} (${t.teamRank}) â€“ <strong>${t.teamName}</strong><br>
                            ${o} ${r}<br>
                            âœ… ${t.teamSolves}
                        </div>`}).join("<hr>")),t.innerHTML=`
                <td><a href="${e.url}" target="_blank">${e.name}</a></td>
                <td class="stars">${c||"â€”"}</td>
                <td class="pda-cell">${e.numberOfPda2025Teams}</td>
                <td class="chilean-cell">${e.numberOfChilean2025Teams}</td>
                <td>${e.season??""}</td>
                <td>${(e.duration/3600).toFixed(1)} horas</td>
            `,s){const e=t.querySelector(".chilean-cell");tippy(e,{content:s,allowHTML:!0,theme:"light-border",interactive:!0,placement:"right",onShow(e){e.popper.querySelector(".tippy-content").classList.add("scrollable-tooltip")}})}if(o){const e=t.querySelector(".pda-cell");tippy(e,{content:o,allowHTML:!0,theme:"light-border",interactive:!0,placement:"right",onShow(e){e.popper.querySelector(".tippy-content").classList.add("scrollable-tooltip")}})}n.appendChild(t)}),document.getElementById("filter-duration-min").addEventListener("input",applyDurationFilter),document.getElementById("filter-duration-max").addEventListener("input",applyDurationFilter),document.getElementById("sort-pda").addEventListener("click",()=>{sortByPdaDescending(),document.getElementById("sort-pda").blur()}),document.getElementById("sort-chilean").addEventListener("click",()=>{sortByChileanDescending(),document.getElementById("sort-chilean").blur()}),applyDurationFilter()}catch(e){console.error("Error loading gyms:",e)}}populateGymsTable()